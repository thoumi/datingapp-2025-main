<!-- Barre de contrôles (Recherche et Filtres) -->
<div class="flex items-center justify-between mb-4">
    <input 
    type="text" 
    placeholder="Search by email or userName" 
    class="input input-bordered w-full max-w-xs" 
    [(ngModel)]="searchTerm"
    (ngModelChange)="searchUsers(searchTerm)" 
  />
</div>

<div class="h-[75vh] overflow-auto rounded-box border border-base-content/5 bg-base-100">
    <table class="table">
        <thead>
            <tr>
                <th>Email</th>
                <th>UserName</th>
                <th>Active roles</th>
                <th>Roles Edit</th>
                <th>Block/Unblock</th>
                <th>Profile</th>
            </tr>
        </thead>
        <tbody>
            @for (user of users(); track user.id) {
                <tr>
                    <td>{{user.email}}</td>
                    <td>{{user.displayName}}</td>
                    <td>{{user.roles}}</td>
                <td>
                    <button (click)="openRolesModal(user)" class="btn btn-primary">Edit roles</button>
                </td>
                <td>
                    <button 
                      (click)="toggleUser(user)" 
                      [ngClass]="user.isLockedOut ? 'btn-locked' : 'btn-unlocked'">
                      <i [class]="user.isLockedOut ? 'fa fa-lock me-1' : 'fa fa-unlock me-1'"></i>
                      {{ user.isLockedOut ? 'Bloqué' : 'Actif' }}
                    </button>
                  </td>
                  <td>
                    <a [routerLink]="['/members', user.id, 'profile']" class="btn btn-profile" >
                      <i class="fa fa-user"></i>
                    </a>
                </td>
            </tr>
      
            }
        </tbody>
    </table>
</div>

<dialog #rolesModal class="modal">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Edit roles for {{selectedUser?.email}}</h3>

        <fieldset class="fieldset w-full p-4 bg-base-100 border border-base-300 rounded-box">
            <legend class="fieldset-legend">Select roles</legend>
            @for (role of availableRoles; track $index) {
                <label class="fieldset-label">
                    <input 
                        (change)="toggleRole($event, role)"
                        type="checkbox"
                        [checked]="selectedUser?.roles?.includes(role)"
                        class="checkbox"
                        [disabled]="selectedUser?.email === 'admin@test.com' && role === 'Admin'"
                    >
                    {{role}}
                </label>
            }
        </fieldset>
        <div class="modal-action">
            <button (click)="updateRoles()" class="btn btn-primary">Submit</button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>Close</button>
    </form>
</dialog>